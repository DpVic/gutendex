#!/bin/sh

echo "Running pre-push checks..."

echo "1. Running tests..."
make test
if [ $? -ne 0 ]; then
    echo "Tests failed. Aborting push."
    exit 1
fi

echo "2. Running Behat tests..."
make behat
if [ $? -ne 0 ]; then
    echo "Behat tests failed. Aborting push."
    exit 1
fi

echo "3. Running static analysis with PHPStan..."
make phpstan
if [ $? -ne 0 ]; then
    echo "PHPStan failed. Aborting push."
    exit 1
fi

echo "4. Running Rector checks..."
make rector-lint
if [ $? -ne 0 ]; then
    echo "Rector failed. Aborting push."
    exit 1
fi

echo "5. Running code style checks with PHP CS Fixer..."
make cs-lint
if [ $? -ne 0 ]; then
    echo "PHP CS Fixer failed. Aborting push."
    exit 1
fi

echo "All checks passed successfully."
exit 0
